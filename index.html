<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Captura de informações digitadas</title>
</head>
<body>
    <h2>Digite algo!</h2>
    <input type="text">

    <!-- Referência -->
    <!-- https://www.devmedia.com.br/javascript-obtendo-tecla-pressionada/16486 -->
</body>

<script defer>
const endereco = "ws://localhost:9999";
let socket = geraSocket(endereco);

function enviaTeclaDigitada(event) {
    const temConexao = validaEstadoConexao(socket);

    if(temConexao)
        socket.send(event.key);
    else
        {
            alert("Falha ao tentar se conectar ao socket!");
            socket = geraSocket(endereco);
        }
}

function geraSocket(endereco) {
    const socket = new WebSocket(endereco);
    return socket;
}

function validaEstadoConexao(socket) {
    const estadoDaConexao = socket.readyState;
    if(estadoDaConexao == 1) return true;
    if(estadoDaConexao == 2 || estadoDaConexao == 3) return false;
}

document.body.onkeydown = enviaTeclaDigitada;
</script>
</html>